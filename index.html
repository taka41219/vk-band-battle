<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ´ã‚£ã‚¸ãƒ¥ã‚¢ãƒ«ç³»ãƒãƒ³ãƒ‰æˆ¦é—˜åŠ›ãƒãƒˆãƒ«</title>
<style>
body {
  font-family: sans-serif;
  background: #111;
  color: #fff;
  text-align: center;
  padding: 10px;
}
button {
  padding: 10px 20px;
  margin: 5px;
  font-size: 16px;
}
input {
  padding: 8px;
  font-size: 16px;
  width: 80%;
  margin: 5px;
}
#battleScreen { display: none; }
#log {
  background: #000;
  padding: 10px;
  margin-top: 10px;
  height: 200px;
  overflow-y: auto;
  text-align: left;
}
.hidden { display:none; }
</style>
</head>

<body>

<h1>ğŸ¸ ãƒ´ã‚£ã‚¸ãƒ¥ã‚¢ãƒ«ç³»ãƒãƒ³ãƒ‰<br>æˆ¦é—˜åŠ›ãƒãƒˆãƒ«</h1>

<div id="modeScreen">
  <button onclick="selectMode('manual')">æ‰‹å‹•å¯¾æˆ¦</button>
  <button onclick="selectMode('cpu')">CPUå¯¾æˆ¦</button>
</div>

<div id="battleScreen">
  <h2 id="modeLabel"></h2>

  <input id="playerBand" placeholder="è‡ªåˆ†ã®ãƒãƒ³ãƒ‰å">
  <input id="enemyBand" placeholder="å¯¾æˆ¦ç›¸æ‰‹ã®ãƒãƒ³ãƒ‰å">

  <div>
    <button onclick="startBattle()">ãƒãƒˆãƒ«é–‹å§‹</button>
    <button onclick="retire()">ãƒªã‚¿ã‚¤ã‚¢</button>
  </div>

  <div id="status"></div>
  <div id="log"></div>

  <div id="nameEntry" class="hidden">
    <input id="userName" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ">
    <button onclick="saveRecord()">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²</button>
  </div>
</div>

<script>
let mode = "";
let turn = 0;
let player, enemy;
let winCount = 0;

function rand(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function createBand(name) {
  return {
    name,
    hp: rand(1,10000),
    atk: rand(100,9999),
    def: rand(1,5000),
    spd: rand(1,100)
  };
}

function selectMode(m) {
  mode = m;
  document.getElementById("modeScreen").style.display = "none";
  document.getElementById("battleScreen").style.display = "block";
  document.getElementById("modeLabel").textContent =
    m === "manual" ? "æ‰‹å‹•å¯¾æˆ¦ãƒ¢ãƒ¼ãƒ‰" : "CPUå¯¾æˆ¦ãƒ¢ãƒ¼ãƒ‰";
}

function startBattle() {
  const pName = document.getElementById("playerBand").value.trim();
  let eName = document.getElementById("enemyBand").value.trim();

  if (!pName) {
    alert("è‡ªåˆ†ã®ãƒãƒ³ãƒ‰åã‚’å…¥åŠ›ã—ã¦ã­ï¼");
    return;
  }

  if (mode === "cpu") {
    const cpuBands = ["X JAPAN","LUNA SEA","DIR EN GREY","MALICE MIZER","the GazettE"];
    eName = cpuBands[rand(0,cpuBands.length-1)];
  }

  if (!eName) {
    alert("å¯¾æˆ¦ç›¸æ‰‹ã®ãƒãƒ³ãƒ‰åã‚’å…¥åŠ›ã—ã¦ã­ï¼");
    return;
  }

  player = createBand(pName);
  enemy = createBand(eName);
  turn = 0;

  document.getElementById("log").innerHTML = "";
  document.getElementById("enemyBand").value = "";
  document.getElementById("nameEntry").classList.add("hidden");

  log("ğŸ”¥ ãƒãƒˆãƒ«é–‹å§‹ï¼");
  updateStatus();

  battleLoop();
}

function battleLoop() {
  if (player.hp <= 0 || enemy.hp <= 0) {
    endBattle();
    return;
  }

  turn++;
  if (turn > 5) {
    log("â€¦â€¦æ¿€æˆ¦ã®æœ«ã€å‹æ•—ãŒæ±ºã—ãŸï¼");
    player.hp = player.hp > enemy.hp ? player.hp : 0;
    enemy.hp = enemy.hp > player.hp ? enemy.hp : 0;
    endBattle();
    return;
  }

  const first = player.spd >= enemy.spd ? player : enemy;
  const second = first === player ? enemy : player;

  attack(first, second);
  if (second.hp > 0) attack(second, first);

  updateStatus();
  setTimeout(battleLoop, 800);
}

function attack(a, d) {
  let dmg = Math.max(1, a.atk - d.def);
  d.hp -= dmg;
  log(`${a.name} ã®æ”»æ’ƒï¼ ${dmg} ãƒ€ãƒ¡ãƒ¼ã‚¸`);
}

function updateStatus() {
  document.getElementById("status").innerHTML = `
  <p>${player.name} HP:${Math.max(0,player.hp)}</p>
  <p>${enemy.name} HP:${Math.max(0,enemy.hp)}</p>`;
}

function log(text) {
  const l = document.getElementById("log");
  l.innerHTML += text + "<br>";
  l.scrollTop = l.scrollHeight;
}

function endBattle() {
  if (player.hp > 0 && enemy.hp <= 0) {
    log("ğŸ‰ å‹åˆ©ï¼");
    if (player.name !== enemy.name) winCount++;
  } else {
    log("ğŸ’€ æ•—åŒ—â€¦");
    document.getElementById("nameEntry").classList.remove("hidden");
  }
}

function retire() {
  log("ğŸ³ï¸ ãƒªã‚¿ã‚¤ã‚¢ã—ã¾ã—ãŸ");
  document.getElementById("nameEntry").classList.remove("hidden");
}

function saveRecord() {
  const name = document.getElementById("userName").value.trim();
  if (!name) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
  alert(`ç™»éŒ²å®Œäº†ï¼\n${name}\né€£å‹ï¼š${winCount}`);
  winCount = 0;
  document.getElementById("nameEntry").classList.add("hidden");
}
</script>

</body>
</html>
