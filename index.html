<!DOCTYPE html><html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ´ã‚£ã‚¸ãƒ¥ã‚¢ãƒ«ç³»ãƒãƒ³ãƒ‰æˆ¦é—˜åŠ›ãƒãƒˆãƒ«</title>
  <style>
    body { font-family: sans-serif; background:#111; color:#eee; text-align:center; }
    button { padding:10px 20px; margin:5px; font-size:16px; }
    input { padding:8px; font-size:16px; }
    .hidden { display:none; }
    .box { margin:20px auto; padding:15px; border:1px solid #444; max-width:400px; }
  </style>
</head>
<body><h1>ğŸ¸ ãƒ´ã‚£ã‚¸ãƒ¥ã‚¢ãƒ«ç³»ãƒãƒ³ãƒ‰æˆ¦é—˜åŠ›ãƒãƒˆãƒ«</h1><div class="box">
  <h2>ãƒ—ãƒ¬ã‚¤ãƒ¢ãƒ¼ãƒ‰é¸æŠ</h2>
  <button onclick="selectMode('manual')">æ‰‹å‹•å¯¾æˆ¦</button>
  <button onclick="selectMode('cpu')">CPUå¯¾æˆ¦ï¼ˆWikipediaï¼‰</button>
</div><div id="manualBox" class="box hidden">
  <h3>æ‰‹å‹•å¯¾æˆ¦</h3>
  <input id="player" placeholder="è‡ªåˆ†ã®ãƒãƒ³ãƒ‰å"><br><br>
  <input id="enemy" placeholder="å¯¾æˆ¦ç›¸æ‰‹ã®ãƒãƒ³ãƒ‰å"><br><br>
  <button onclick="battleManual()">ãƒãƒˆãƒ«é–‹å§‹</button>
</div><div id="cpuBox" class="box hidden">
  <h3>CPUå¯¾æˆ¦</h3>
  <input id="playerCpu" placeholder="è‡ªåˆ†ã®ãƒãƒ³ãƒ‰å"><br><br>
  <button onclick="battleCPU()">CPUã¨ãƒãƒˆãƒ«</button>
  <p id="cpuStatus"></p>
</div><div id="result" class="box hidden"></div><script>
let mode = '';

function selectMode(m) {
  mode = m;
  document.getElementById('manualBox').classList.add('hidden');
  document.getElementById('cpuBox').classList.add('hidden');
  document.getElementById('result').classList.add('hidden');
  if (m === 'manual') document.getElementById('manualBox').classList.remove('hidden');
  if (m === 'cpu') document.getElementById('cpuBox').classList.remove('hidden');
}

function createStatus(name) {
  const seed = name.split('').reduce((a,c)=>a+c.charCodeAt(0),0);
  return {
    name,
    hp: (seed * 13) % 10000 + 1,
    atk: (seed * 17) % 9900 + 100,
    def: (seed * 19) % 5000 + 1,
    spd: (seed * 23) % 100 + 1
  };
}

function battleRPG(pName, eName) {
  let p = createStatus(pName);
  let e = createStatus(eName);
  let log = [];
  let turn = 1;

  let first = p.spd >= e.spd ? p : e;
  let second = first === p ? e : p;

  log.push(`âš¡ ç´ æ—©ã•åˆ¤å®šï¼š${first.name} ãŒå…ˆåˆ¶ï¼`);

  while (p.hp > 0 && e.hp > 0) {
    if (turn > 5) {
      log.push('â© æ¿€æˆ¦ãŒç¶šã„ãŸãŸã‚ã€å‹è² ã¯ä¸€æ°—ã«æ±ºç€ã¸â€¦');
      break;
    }

    let dmg1 = Math.max(1, first.atk - second.def);
    second.hp -= dmg1;
    log.push(`Turn ${turn}: ${first.name} ã®æ”»æ’ƒ â†’ ${dmg1} ãƒ€ãƒ¡ãƒ¼ã‚¸`);
    if (second.hp <= 0) break;

    let dmg2 = Math.max(1, second.atk - first.def);
    first.hp -= dmg2;
    log.push(`${second.name} ã®åæ’ƒ â†’ ${dmg2} ãƒ€ãƒ¡ãƒ¼ã‚¸`);

    turn++;
  }

  let result;
  if (p.hp === e.hp) result = 'ğŸ¤ å¼•ãåˆ†ã‘';
  else if (p.hp > e.hp) result = `ğŸ† ${p.name} ã®å‹åˆ©ï¼`;
  else result = `ğŸ’€ ${p.name} ã®æ•—åŒ—â€¦`;

  const box = document.getElementById('result');
  box.innerHTML = `<h3>çµæœ</h3><pre>${log.join('
')}</pre><br>${result}`;box.classList.remove('hidden'); }

function battleManual() { const p = player.value.trim(); const e = enemy.value.trim(); if (!p || !e) return alert('åå‰ã‚’å…¥åŠ›ã—ã¦ã­'); if (p === e) return alert('åŒåãƒãƒˆãƒ«ã¯ã§ãã¾ã›ã‚“'); battleRPG(p, e); enemy.value = ''; }

async function battleCPU() { const p = playerCpu.value.trim(); if (!p) return alert('åå‰ã‚’å…¥åŠ›ã—ã¦ã­'); const status = document.getElementById('cpuStatus'); status.textContent = 'ğŸ“¡ Wikipediaæ¥ç¶šä¸­â€¦';

try { const url = 'https://ja.wikipedia.org/w/api.php?action=query&list=search&srsearch=ãƒ´ã‚£ã‚¸ãƒ¥ã‚¢ãƒ«ç³» ãƒãƒ³ãƒ‰&format=json&origin=*'; const res = await fetch(url); const data = await res.json(); const list = data.query.search; const cpu = list[Math.floor(Math.random()*list.length)].title; status.textContent = æ•µãƒãƒ³ãƒ‰å‡ºç¾ï¼ã€Œ${cpu}ã€; battleRPG(p, cpu); } catch { status.textContent = 'âŒ å–å¾—å¤±æ•—'; } } </script>

</body>
</html>
